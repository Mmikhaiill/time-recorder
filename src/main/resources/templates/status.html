<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="2">
    <title>Статус системы</title>
    <link rel="stylesheet" href="/css/status.css">
</head>
<body>
<h1>Статус системы</h1>

<nav>
    <a href="/api/records/html">Записи</a>
    <a href="/api/status">JSON</a>
    <a href="/actuator/health">Health</a>
</nav>

<div class="dashboard">
    <!-- База данных -->
    <div th:class="'card ' + (${status.databaseAvailable} ? 'card-ok' : 'card-err')">
        <div class="card-title">База данных</div>
        <div class="card-value" th:text="${status.databaseAvailable} ? 'Подключена' : 'Недоступна'"></div>
    </div>

    <!-- Буфер -->
    <div th:class="'card ' + (${status.bufferedRecordsCount > 0} ? 'card-warn' : '')">
        <div class="card-title">Буфер</div>
        <div class="card-value">
            <span th:text="${status.bufferedRecordsCount}">0</span> /
            <span th:text="${status.maxBufferCapacity}">100000</span>
        </div>
        <div class="progress">
            <div th:class="'progress-fill ' + (${status.bufferUtilization > 80} ? 'fill-red' : (${status.bufferUtilization > 50} ? 'fill-yellow' : ''))"
                 th:style="'width:' + ${status.bufferUtilization} + '%'"></div>
        </div>
    </div>

    <!-- Записано -->
    <div class="card">
        <div class="card-title">Записано</div>
        <div class="card-value" th:text="${#numbers.formatInteger(status.totalRecordsWritten, 1, 'COMMA')}">0</div>
    </div>

    <!-- Потеряно -->
    <div th:class="'card ' + (${status.recordsDropped > 0} ? 'card-warn' : '')">
        <div class="card-title">Потеряно</div>
        <div class="card-value" th:text="${#numbers.formatInteger(status.recordsDropped, 1, 'COMMA')}">0</div>
    </div>

    <!-- Переподключения -->
    <div class="card">
        <div class="card-title">Переподключения</div>
        <div class="card-value" th:text="${status.reconnectionAttempts}">0</div>
    </div>

    <!-- Запись -->
    <div class="card">
        <div class="card-title">Запись</div>
        <div class="card-value" th:text="${status.recordingEnabled} ? 'Вкл' : 'Выкл'">Вкл</div>
    </div>

    <!-- Аптайм -->
    <div class="card">
        <div class="card-title">Работает</div>
        <div class="card-value" th:text="${status.uptime} ?: '-'">0s</div>
    </div>

    <!-- Последняя запись -->
    <div class="card">
        <div class="card-title">Последняя запись</div>
        <div class="card-value" th:text="${status.lastSuccessfulWrite != null} ? ${#temporals.format(status.lastSuccessfulWrite, 'HH:mm:ss')} : 'Нет'"></div>
    </div>
</div>

<p class="footnote">
    Обновлено: <span th:text="${#temporals.format(#temporals.createNow(), 'HH:mm:ss')}"></span>
</p>
</body>
</html>